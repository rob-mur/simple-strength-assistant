---
phase: 02-debug-and-fix-file-picker
plan: 03
subsystem: state-management
tags: [reactivity, dioxus-0.7, signals, bugfix]
---

# Phase 02 Plan 03: Refactor WorkoutState for Reactivity and Fix Error Flow

**Refactor WorkoutState to use Dioxus 0.7 Signals for reactivity and fix incorrect error handling in setup_database to ensure the 'Select Database Location' button shows correctly.**

## Problem
1. **No UI Reactivity:** `WorkoutState` uses `Rc<RefCell>` which is not reactive in Dioxus 0.7. The `App` component doesn't re-render when the state changes.
2. **Premature Error State:** `setup_database` returns `Err` when transitioning to `SelectingFile`, which `App` then handles by setting the state to `Error`.

## Proposed Fix
1. Refactor `WorkoutState` to use `Signal<T>` for its fields.
2. Update `setup_database` to return `Ok(())` for the `SelectingFile` transition.
3. Clean up `src/app.rs` to remove redundant signals and use the reactive state.

## Tasks

### Task 1: Refactor WorkoutState to use Signals
- Update `WorkoutStateInner` to use `Signal<T>` for `initialization_state`, `current_session`, `error_message`, `database`, and `file_manager`.
- Update `WorkoutState` methods to use `.set()` and `()` for reading/writing.
- Ensure `WorkoutState::new()` initializes signals correctly.

### Task 2: Fix setup_database return logic
- Update `WorkoutStateManager::setup_database` to return `Ok(())` instead of `Err` when transitioning to `SelectingFile`.
- Remove the temporary error message "Waiting for user to select file - not an error, normal flow".

### Task 3: Update App component and verify reactivity
- Remove `_init_state` signal from `App`.
- Ensure `match workout_state.initialization_state()` in `App` correctly subscribes to the reactive signal.
- Verify that the loading spinner transitions to the "Select Database Location" button automatically.

## Verification
- [ ] No cached handle: App shows loading, then transitions to "Select Database Location" button.
- [ ] Console shows logs but no "Initialization Error" card appears prematurely.
- [ ] Clicking button successfully prompts for file and transitions to Ready state.
