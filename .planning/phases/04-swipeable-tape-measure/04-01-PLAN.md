---
phase: 04-swipeable-tape-measure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: ["src/components/mod.rs", "src/components/tape_measure.rs", "src/main.rs"]
autonomous: true
requirements: ["TAPE-01", "TAPE-02", "TAPE-05"]
user_setup: []

must_haves:
  truths:
    - "TapeMeasure component exists and can be imported"
    - "Component handles pointer events (down, move, up) without native scrolling interference"
    - "Pointer capture is correctly set on pointer down"
  artifacts:
    - path: "src/components/tape_measure.rs"
      provides: "Core component definition and event handlers"
    - path: "src/components/mod.rs"
      provides: "Module export for components"
  key_links:
    - from: "src/main.rs"
      to: "src/components/mod.rs"
      via: "mod components;"
---

<objective>
Create the foundation for the TapeMeasure component, implementing the state management and core pointer event handling.

Purpose: To provide a reliable, scroll-locked drag interface for numerical input.
Output: A new Dioxus component that tracks pointer movement and updates an internal offset.
</objective>

<execution_context>
@./.gemini/get-shit-done/workflows/execute-plan.md
@./.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/milestones/v1.1-phases/04-swipeable-tape-measure/04-CONTEXT.md
@.planning/milestones/v1.1-phases/04-swipeable-tape-measure/04-RESEARCH.md
@src/app.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create components module and TapeMeasure scaffold</name>
  <files>src/components/mod.rs, src/components/tape_measure.rs, src/main.rs</files>
  <action>
    - Register the `components` module in `src/main.rs`.
    - Create `src/components/mod.rs` to export the `tape_measure` module.
    - Create `src/components/tape_measure.rs` with a basic `TapeMeasure` component that accepts `value: f64`, `min: f64`, `max: f64`, `step: f64`, and an `on_change: EventHandler<f64>` prop.
    - Define internal state: `offset: Signal<f64>`, `velocity: Signal<f64>`, `is_dragging: Signal<bool>`, `last_pointer_x: Signal<f64>`, `last_update_time: Signal<f64>`.
  </action>
  <verify>
    Cargo check passes. File src/components/tape_measure.rs exists.
  </verify>
  <done>
    Component scaffold created and registered.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Pointer Event Handlers and Capture</name>
  <files>src/components/tape_measure.rs</files>
  <action>
    - Add `onpointerdown`, `onpointermove`, and `onpointerup` handlers to the SVG container.
    - In `onpointerdown`:
        1. Set `is_dragging` to true.
        2. Set `last_pointer_x` to the pointer's X coordinate.
        3. Call `set_pointer_capture` using `web_sys` from the raw event target.
        4. Set `velocity` to 0.0.
        5. Set `last_update_time` to the current timestamp.
    - In `onpointermove`:
        1. If `is_dragging` is true, calculate `delta_x` = `current_x - last_pointer_x`.
        2. Update `offset` by `delta_x`.
        3. Calculate instantaneous velocity: `delta_x / (now - last_update_time)`.
        4. Smooth the velocity (simple average or low-pass).
        5. Update `last_pointer_x` and `last_update_time`.
    - In `onpointerup`:
        1. Set `is_dragging` to false.
        2. Release pointer capture.
    - Apply `touch-action: none` to the SVG container to satisfy TAPE-05.
  </action>
  <verify>
    Dioxus signals update as expected when simulated pointer events occur.
  </verify>
  <done>
    Dragging logic implemented with pointer capture and scroll locking.
  </done>
</task>

</tasks>

<verification>
Check that the component handles drag events and correctly calculates velocity on pointer release.
</verification>

<success_criteria>
- Component maintains drag focus even if the pointer leaves the element.
- Browser does not scroll while dragging the tape measure.
- Velocity is calculated and stored correctly for the momentum phase.
</success_criteria>

<output>
After completion, create `.planning/phases/04-swipeable-tape-measure/04-01-SUMMARY.md`
</output>
