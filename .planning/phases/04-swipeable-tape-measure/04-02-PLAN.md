---
phase: 04-swipeable-tape-measure
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified: ["src/components/tape_measure.rs"]
autonomous: true
requirements: ["TAPE-01", "TAPE-02", "TAPE-03", "TAPE-04"]
user_setup: []

must_haves:
  truths:
    - "SVG rendering accurately reflects the current offset"
    - "Central value is full opacity, while outer values are faded"
    - "Component glides with momentum after dragging stops"
    - "Component snaps correctly to the nearest increment"
    - "Clicks on numbers trigger an animated jump"
  artifacts:
    - path: "src/components/tape_measure.rs"
      provides: "Momentum loop, Snapping, SVG Rendering, and Click-to-Jump"
---

<objective>
Implement the visual representation of the tape measure using SVG and add physics (momentum + snapping).

Purpose: To provide high-performance visual feedback and a natural "feel" during interaction.
Output: A functional SVG tape measure with momentum, snapping, and dynamic opacity.
</objective>

<execution_context>
@./.gemini/get-shit-done/workflows/execute-plan.md
@./.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/milestones/v1.1-phases/04-swipeable-tape-measure/04-CONTEXT.md
@.planning/milestones/v1.1-phases/04-swipeable-tape-measure/04-RESEARCH.md
@.planning/phases/04-swipeable-tape-measure/04-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Momentum Glide and Snapping Loop</name>
  <files>src/components/tape_measure.rs</files>
  <action>
    - Add a `use_future` loop that runs while `velocity.abs() > 0.1` or `!is_snapped`.
    - In the momentum phase:
        1. If `!is_dragging`: `offset += velocity`, `velocity *= 0.95` (friction).
        2. If `velocity.abs() < threshold`: Enter snapping phase.
    - In the snapping phase:
        1. Calculate `target_offset = round(offset / pixels_per_step) * pixels_per_step`.
        2. Interpolate `offset` toward `target_offset` (e.g., Ease-out).
        3. Once close enough, set `offset = target_offset` and update the parent `value` via `on_change`.
    - Satisfy TAPE-03 (Snap to increments).
  </action>
  <verify>
    Component glides smoothly on release and snaps cleanly to an increment.
  </verify>
  <done>
    Momentum and snapping physics implemented.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement SVG Rendering with Dynamic Opacity</name>
  <files>src/components/tape_measure.rs</files>
  <action>
    - Define a `pixels_per_step` constant (e.g., 60px).
    - Render an SVG `viewBox` (e.g., `0 0 300 80`).
    - Map the `offset` signal to the `transform="translate({offset}, 0)"` of a group `<g>`.
    - Inside the group:
        1. Render tick marks (`line`) and numbers (`text`) for a range around the current center.
        2. Calculate opacity for each text/tick: `1.0 - (dist_from_center / max_fade).powf(2.0)`.
        3. Use simple ticks under each number and a larger fixed central tick (the "needle").
    - Satisfy CONTEXT requirement for "Opacity-driven focus".
  </action>
  <verify>
    Central value is brightest, fading out toward edges. Ticks align with numerical values.
  </verify>
  <done>
    SVG rendering and aesthetic constraints met.
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement Click-to-Jump and Edge Resistance</name>
  <files>src/components/tape_measure.rs</files>
  <action>
    - Add `onclick` handlers to individual numbers or invisible areas of the tape (TAPE-04).
    - When clicked: Initiate an animated jump by setting a large `velocity` or directly animating `offset`.
    - Implement "Hard wall" edge resistance by clamping `offset` between `(min - center)` and `(max - center)` values.
    - Ensure any "tap" during momentum immediately stops the wheel and triggers a snap (CONTEXT requirement).
  </action>
  <verify>
    Clicks on the tape cause it to jump and center the clicked value. Dragging past min/max is blocked.
  </verify>
  <done>
    Jump functionality and boundary constraints implemented.
  </done>
</task>

</tasks>

<verification>
Verify smooth motion, accurate value mapping, and visual correctness of the opacity fade and central focus.
</verification>

<success_criteria>
- Component glides and snaps as requested.
- Visuals match the "Aesthetic" requirements from CONTEXT.md.
- Click-to-jump is responsive and accurate.
</success_criteria>

<output>
After completion, create `.planning/phases/04-swipeable-tape-measure/04-02-SUMMARY.md`
</output>
