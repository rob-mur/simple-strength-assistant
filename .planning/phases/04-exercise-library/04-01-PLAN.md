---
phase: 04-exercise-library
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/features/tab_navigation_ui.feature
  - tests/features/tab_state_preservation.feature
  - tests/steps/tab_navigation.rs
autonomous: true
requirements:
  - LIB-01
  - LIB-02

must_haves:
  truths:
    - "BDD feature files describe tab switching behavior"
    - "BDD feature files describe session state preservation across tab switches"
    - "Test step definitions exist to run the scenarios"
  artifacts:
    - path: "tests/features/tab_navigation_ui.feature"
      provides: "Gherkin scenarios for tab UI interactions"
      min_lines: 30
    - path: "tests/features/tab_state_preservation.feature"
      provides: "Gherkin scenarios for workout session state preservation"
      min_lines: 40
    - path: "tests/steps/tab_navigation.rs"
      provides: "Step definition stubs for tab scenarios"
      min_lines: 50
  key_links:
    - from: "tests/features/tab_navigation_ui.feature"
      to: "tests/steps/tab_navigation.rs"
      via: "cucumber-rust step bindings"
      pattern: "#\\[given|when|then\\]"
---

<objective>
Define BDD acceptance criteria for tab navigation before implementation begins. This establishes the behavior contract that the implementation must satisfy.

Purpose: TDD/BDD-first approach ensures implementation is driven by testable requirements rather than ad-hoc development. Feature files serve as executable documentation.

Output: Two feature files covering UI interactions and state preservation, plus step definition scaffolding ready for implementation phase.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-exercise-library/04-CONTEXT.md
@.planning/phases/04-exercise-library/04-RESEARCH.md

<existing_patterns>
From tests/features/tape_measure_core.feature - cucumber-rust pattern:
```gherkin
Feature: TapeMeasure Core Interaction

  Scenario: Smooth dragging
    Given the TapeMeasure component is rendered
    When I press down on the component at X 100
    And I move the pointer to X 150
    Then the internal offset should increase by 50 units
```

From CONTEXT.md - Required test tags:
- @e2e for Playwright (2-3 critical flows)
- @unit for mocked component tests (broader coverage)
</existing_patterns>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write tab navigation feature files</name>
  <files>
    tests/features/tab_navigation_ui.feature
    tests/features/tab_state_preservation.feature
  </files>
  <action>
Create two Gherkin feature files following cucumber-rust patterns:

**tests/features/tab_navigation_ui.feature** (UI interactions):
- Feature: Tab Navigation UI
- Tag @e2e scenarios for Playwright (2-3 critical flows):
  - User can see Workout and Library tabs
  - User can click Library tab and see placeholder
  - User can switch back to Workout tab
- Tag @unit scenarios for mocked component tests (broader coverage):
  - Tab active state indication (visual styling)
  - Tab click events trigger state changes
  - Tab accessibility (role="tablist", aria-selected)

**tests/features/tab_state_preservation.feature** (state logic):
- Feature: Workout Session State Preservation
- Tag @e2e scenarios for Playwright:
  - Active workout session persists when switching to Library and back
  - Tab selection persists after browser refresh
- Tag @unit scenarios for mocked tests:
  - WorkoutState context remains accessible across tab switches
  - localStorage correctly saves/loads active tab selection
  - Tab state initialization from localStorage on mount

Follow existing patterns from tests/features/tape_measure_core.feature:
- Given/When/Then structure
- Clear, testable assertions
- Scenario titles describe user-observable behavior

Each feature file should be 30-50 lines with 4-6 scenarios total.
  </action>
  <verify>
    <automated>grep -l "Feature: Tab Navigation UI" tests/features/tab_navigation_ui.feature && grep -l "Feature: Workout Session State Preservation" tests/features/tab_state_preservation.feature && grep -c "@e2e" tests/features/tab_navigation_ui.feature && grep -c "@unit" tests/features/tab_state_preservation.feature</automated>
  </verify>
  <done>
Two feature files exist with tagged scenarios covering both e2e and unit test levels. Feature files follow cucumber-rust Gherkin syntax with Given/When/Then steps.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create step definition scaffolding</name>
  <files>tests/steps/tab_navigation.rs</files>
  <action>
Create tests/steps/tab_navigation.rs with step definition stubs for both feature files:

Structure:
```rust
use cucumber::{given, when, then, World};

#[derive(Debug, Default, World)]
pub struct TabNavigationWorld {
    // State for test execution
}

// Step definitions matching tab_navigation_ui.feature
#[given("...")]
async fn step_definition(world: &mut TabNavigationWorld) {
    todo!("Implement in Phase 4 Plan 02")
}

// Step definitions matching tab_state_preservation.feature
// ... (similar pattern)
```

Follow patterns from existing test step files in tests/steps/ directory. Each step definition should:
- Have matching function signature for Given/When/Then
- Include descriptive function names
- Use `todo!()` macro for implementation placeholder
- Add comment indicating implementation happens in Plan 02

Create stubs for ALL steps referenced in both feature files (approximately 15-20 step definitions). Group related steps together with section comments.
  </action>
  <verify>
    <automated>cargo check --tests 2>&1 | grep -q "tests/steps/tab_navigation.rs" && grep -c "todo!" tests/steps/tab_navigation.rs</automated>
  </verify>
  <done>
tests/steps/tab_navigation.rs file exists with stub implementations for all steps from both feature files. File compiles successfully with cargo check. All stubs marked with todo!() macro.
  </done>
</task>

</tasks>

<verification>
Run cucumber tests to verify feature files are parseable:
```bash
cargo test --test cucumber_tests -- --tags @unit 2>&1 | grep -E "(Feature|Scenario|pending)"
```

Expected: All scenarios parse successfully but show "pending" status (steps not implemented yet).

Confirm file structure:
```bash
ls -la tests/features/tab_*.feature tests/steps/tab_navigation.rs
```
</verification>

<success_criteria>
- [ ] tests/features/tab_navigation_ui.feature exists with 3-4 scenarios tagged @e2e and @unit
- [ ] tests/features/tab_state_preservation.feature exists with 3-4 scenarios tagged @e2e and @unit
- [ ] Both feature files follow cucumber-rust Gherkin syntax
- [ ] tests/steps/tab_navigation.rs exists with stub implementations for all steps
- [ ] `cargo check --tests` passes with no compilation errors
- [ ] Feature files are executable but show pending status (implementation deferred to Plan 02)
- [ ] Requirements LIB-01 and LIB-02 have clear acceptance criteria in feature files
</success_criteria>

<output>
After completion, create `.planning/phases/04-exercise-library/04-01-SUMMARY.md`
</output>
