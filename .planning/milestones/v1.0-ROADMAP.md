# Milestone v1.0: File Picker Fix

**Status:** ✅ SHIPPED 2026-02-26
**Phases:** 1-3
**Total Plans:** 6

## Overview

Fix the broken file picker that's preventing users from selecting where to store their workout database. We'll set up the development environment to capture errors, debug the File System Access API integration, fix the root cause, and verify the complete database initialization flow works reliably.

## Phases

### Phase 1: Development Environment
**Goal**: Development environment runs with browser console access for debugging
**Depends on**: Nothing (first phase)
**Plans**: 1 plan

Plans:
- [x] 01-01-PLAN.md — Initialize Dioxus logger and verify dev environment with console debugging

**Details:**
- `dx serve` runs without errors and serves app in browser
- Browser loads the app and UI renders
- Console logs show initialization steps clearly
- WASM module loads successfully

### Phase 2: Debug and Fix File Picker
**Goal**: File picker appears when triggered and user can select database file
**Depends on**: Phase 1
**Plans**: 4 plans

Plans:
- [x] 02-01-PLAN.md — Fix user gesture requirement by adding button to SelectingFile UI and preventing auto-prompt
- [x] 02-02-PLAN.md — Add permission state verification for cached handles with queryPermission/requestPermission
- [x] 02-03-PLAN.md — Refactor WorkoutState for reactivity and fix error flow (gap closure)
- [x] 02-04-PLAN.md — Fix Database initialization execution order (bug fix)

**Details:**
- File picker dialog appears when user needs to select database
- User can select .sqlite or .db file from filesystem
- File System Access API permission prompt appears correctly
- Selected file handle is accessible from Rust code

### Phase 3: Verify and Polish
**Goal**: Complete database initialization flow works end-to-end with proper error handling
**Depends on**: Phase 2
**Plans**: 1 plan

Plans:
- [x] 03-01-PLAN.md — Enhance error UX and verify end-to-end initialization flow with comprehensive testing

**Details:**
- Selected file handle persists across browser refresh
- Database initializes successfully after file selection
- LocalStorage fallback works when API unavailable
- User-friendly error messages for common failure modes

---

## Milestone Summary

**Key Decisions:**
- **Inline initialization after file selection**: Eliminated fragile error message string matching by continuing database initialization inline after successful file selection.
- **Added public setter methods to WorkoutState**: Required to allow UI button handler to store database and file manager after initialization.
- **Separate permission checking from handle retrieval**: Clean separation of concerns, handles all permission states explicitly.
- **Refactored WorkoutState to use Signals**: Followed Dioxus 0.7 best practices for reactivity.
- **crossorigin="use-credentials" for manifest**: Required for Vercel deployment protection to allow manifest fetch.

**Issues Resolved:**
- File picker not appearing due to missing user gesture.
- PWA manifest 401 error on Vercel deployments.
- Database initialization failure due to incorrect execution order in `Database::init`.
- Permission re-requesting for cached file handles (no redundant picker).
- Fixed retry loops for invalid file handles by clearing IndexedDB on validation failure.

**Issues Deferred:**
- None for v1.0 scope.

**Technical Debt Incurred:**
- Manual `file-handle-storage.js` integration is functional but could be more robustly abstracted in a future infrastructure phase.

---
_For current project status, see .planning/ROADMAP.md_
